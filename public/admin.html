<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - Sistem POS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/admin.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="icon" href="/favicon.ico">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
                <button class="btn btn-outline-light btn-sm me-3" id="sidebarToggle" type="button" title="Tampilkan/Sembunyikan Sidebar"><i class="bi bi-list"></i></button>
                <a href="/pos.html" target="_blank" class="btn btn-warning btn-sm me-2"><i class="bi bi-shop"></i> <span data-i18n="buttons.pos_page">Halaman Kasir</span></a>
                <a href="/revenue" class="btn btn-success btn-sm me-2"><i class="bi bi-cash-coin"></i> Pendapatan</a>
                <button class="btn btn-info btn-sm me-2" id="checkUpdateBtn" title="Cek Update Aplikasi">
                    <i class="bi bi-cloud-download"></i> Cek Update
                </button>
            </div>
            <div class="d-flex align-items-center">
                <span class="navbar-text text-light me-3">Admin: <span id="userName"></span></span>
                <span class="badge bg-info text-dark me-3" id="appVersion">v1.0.0</span>
                <button class="btn btn-outline-light btn-sm" id="logoutBtn">Keluar</button>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4" id="layoutRoot">
        <div class="row">
            <nav id="sidebar" class="col-md-3 col-lg-2 d-none d-md-block bg-light sidebar">
                <div class="position-sticky pt-3" style="font-size: larger; font-style: oblique;">
                    <div class="px-3 mb-2 d-flex justify-content-center">
                        <label class="bb8-toggle" style="font-size: 8px; margin: 0;">
                        <input class="bb8-toggle__checkbox" type="checkbox" id="darkModeToggle">
                        <div class="bb8-toggle__container">
                          <div class="bb8-toggle__scenery">
                            <div class="bb8-toggle__star"></div>
                            <div class="bb8-toggle__star"></div>
                            <div class="bb8-toggle__star"></div>
                            <div class="bb8-toggle__star"></div>
                            <div class="bb8-toggle__star"></div>
                            <div class="bb8-toggle__star"></div>
                            <div class="bb8-toggle__star"></div>
                            <div class="tatto-1"></div>
                            <div class="tatto-2"></div>
                            <div class="gomrassen"></div>
                            <div class="hermes"></div>
                            <div class="chenini"></div>
                            <div class="bb8-toggle__cloud"></div>
                            <div class="bb8-toggle__cloud"></div>
                            <div class="bb8-toggle__cloud"></div>
                          </div>
                          <div class="bb8">
                            <div class="bb8__head-container">
                              <div class="bb8__antenna"></div>
                              <div class="bb8__antenna"></div>
                              <div class="bb8__head"></div>
                            </div>
                            <div class="bb8__body"></div>
                          </div>
                          <div class="artificial__hidden">
                            <div class="bb8__shadow"></div>
                          </div>
                        </div>
                      </label>
                    </div>
                    <div class="px-3 mb-2 d-flex align-items-center gap-1" style="text-align:center;">
                        <img id="brandLogo" src="" alt="Logo" style="height:48px; width:48px; object-fit:contain; display:inline-block; visibility:hidden; " />
                        <b><span id="brandName" >Admin Panel</span></b>
                    </div>
                    <div class="px-3 mb-2 text-center">
                        <span id="adminClock" class="text-muted"></span>
                    </div>
                    <div class="px-3 mb-2 text-center">
                        <span id="trialStatusBadge" class="badge bg-warning text-dark"></span>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link active" href="#" data-view="dashboard">Dashboard</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-view="products">Kelola Produk</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-view="categories">Kelola Kategori</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-view="transactions">Transaksi</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-view="shifts">Shift Kasir</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-view="users">Kelola Pengguna</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-view="customers">Kelola Pelanggan</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-view="customer-debts">Hutang Customer</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-view="suppliers">Supplier &amp; Barang Masuk</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-view="credits">Kredit &amp; Hutang</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-view="settings">Pengaturan</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-view="license">Lisensi</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-view="banners">Kelola Banner</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-view="qris">Kelola QRIS</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-view="backup">Backup</a></li>
                        <li class="nav-item"><a class="nav-link" href="/admin/sync">Sinkronisasi</a></li>
                        <li class="nav-item"><a class="nav-link" href="/dev-settings.html" target="_blank">
                            <i class="bi bi-gear-fill"></i> Dev Settings
                        </a></li>
                    </ul>
                </div>
            </nav>

            <main id="mainContent" class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div id="content-area">
                    <!-- Dashboard View -->
                    <div id="dashboard-view" class="view-content">
                        <h2>Dasbor</h2>
                        <div id="licenseCardAdmin" class="alert alert-warning d-flex justify-content-between align-items-center mt-2">
                            <div>
                                <strong>License:</strong> <span id="licenseStatusAdminText">Belum aktif</span>
                            </div>
                            <div class="d-flex gap-2" style="max-width: 380px;">
                                <input type="text" class="form-control form-control-sm" id="licenseKeyInputAdmin" placeholder="Masukkan LICENSE KEY">
                                <button class="btn btn-sm btn-primary" type="button" id="licenseSaveBtnAdmin">Simpan</button>
                            </div>
                        </div>
                        <div class="row g-3 mt-2">
                            <div class="col-lg-8">
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3">Tren Penjualan (7 Hari)</h5>
                                        <canvas id="salesTrendChart" height="120"></canvas>
                                    </div>
                                </div>
                                <!-- Expired Products List -->
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">Daftar Produk Expired</h5>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-sm btn-outline-success" id="exportExpiredBtn"><i class="bi bi-file-earmark-spreadsheet"></i> Export XLSX</button>
                                            <button class="btn btn-sm btn-outline-secondary" id="refreshExpiredBtn"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div id="expiredList">
                                            <p class="text-muted mb-0">Memuat data produk expired...</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Low Stock Widget moved below expired -->
                                <div class="card mt-3">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0">Stok Habis / Menipis (&lt; 5)</h5>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-sm btn-outline-success" id="exportLowStockBtn"><i class="bi bi-file-earmark-spreadsheet"></i> Export XLSX</button>
                                            <button class="btn btn-sm btn-outline-secondary" id="refreshLowStockBtn"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <div>
                                                <span class="me-1">Tampilkan</span>
                                                <select id="lowStockPageSize" class="form-select form-select-sm d-inline-block w-auto">
                                                    <option value="5">5</option>
                                                    <option value="10" selected>10</option>
                                                    <option value="25">25</option>
                                                    <option value="50">50</option>
                                                    <option value="75">75</option>
                                                    <option value="100">100</option>
                                                    <option value="all">All</option>
                                                </select>
                                                <span class="ms-1">data</span>
                                            </div>
                                            <nav id="lowStockPaginationTop"></nav>
                                        </div>
                                        <div id="lowStockList">
                                            <p class="text-muted mb-0">Memuat data stok rendah...</p>
                                        </div>
                                        <div class="d-flex justify-content-center mt-2">
                                            <nav id="lowStockPaginationBottom"></nav>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3">Produk Teratas</h5>
                                        <canvas id="topProductsChart" height="200"></canvas>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3">Distribusi Kategori</h5>
                                        <canvas id="categoryDistChart" height="200"></canvas>
                                    </div>
                                </div>
                                <div class="card mt-3">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3">Pendapatan per Metode</h5>
                                        <canvas id="revenueByMethodChart" height="200"></canvas>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        

                </div>
    <!-- Products View -->
                    <div id="products-view" class="view-content" style="display:none;">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h2 data-i18n="products.title">Kelola Produk</h2>
                            <div>
                                <button class="btn btn-success me-2" data-i18n="buttons.export_xlsx">
                                    <i class="bi bi-download"></i> Export ke XLSX
                                </button>
                                <button class="btn btn-info me-2">
                                    <i class="bi bi-file-earmark-spreadsheet"></i> Unduh Template
                                </button>
                                
                                <div class="btn-group me-2" role="group">
                                    <button class="btn btn-secondary" id="chooseFileBtn">
                                        <i class="bi bi-folder-open"></i> Pilih File
                                    </button>
                                    <button class="btn btn-warning" id="importFileBtn" disabled>
                                        <i class="bi bi-upload"></i> Impor Sekarang
                                    </button>
                                </div>
                                <small class="text-muted me-3" id="selectedFileName">Tidak ada file yang dipilih</small>
                                
                                <input type="file" id="importFileInput" accept=".xlsx" style="display: none;">
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#productModal" data-action="add" data-i18n="products.add_product">Tambah Produk</button>
                            </div>

            
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                                    <input type="text" class="form-control" id="productSearchInput" data-i18n-placeholder="products.search_placeholder" placeholder="Cari berdasarkan nama produk atau kategori...">
                                    <button class="btn btn-outline-secondary" type="button" id="clearSearchBtn" data-i18n="products.clear">Hapus</button>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="productCategoryFilter">
                                    <option value="" data-i18n="buttons.all_categories">Semua Kategori</option>
                                </select>
                            </div>
                        </div>

                        <!-- PERUBAHAN: Tambahkan kontrol pagination di atas -->
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div>
                                <span data-i18n="products.show">Tampilkan</span> 
                                <select class="form-select d-inline-block w-auto" id="pageSizeSelect">
                                    <option value="10" selected>10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                    <option value="all">Semua</option>
                                </select>
                                <span data-i18n="products.entries">data</span>
                            </div>
                            <div class="ms-2 d-inline-flex align-items-center gap-2">
                                <button class="btn btn-sm btn-outline-secondary" id="printSelectedQrBtn" onclick="printSelectedQr()" data-i18n="buttons.print_qr">Cetak QR (Terpilih)</button>
                                <button class="btn btn-sm btn-outline-secondary" id="printSelectedBarcodeBtn" onclick="printSelectedBarcode()" data-i18n="buttons.print_barcode">Cetak Barcode (Terpilih)</button>
                                <button class="btn btn-sm btn-outline-primary" id="printAllQrBtn" onclick="printAllQr()">Cetak QR (Semua Filter)</button>
                                <button class="btn btn-sm btn-outline-primary" id="printAllBarcodeBtn" onclick="printAllBarcode()">Cetak Barcode (Semua Filter)</button>
                                <label class="ms-2 small text-muted">Kolom:</label>
                                <select id="printColsSelect" class="form-select form-select-sm w-auto">
                                    <option value="2">2</option>
                                    <option value="3" selected>3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                                <label class="ms-2 small text-muted">Duplikat:</label>
                                <input id="printDupCount" type="number" class="form-control form-control-sm w-auto" value="1" min="1" max="50" />
                                <button class="btn btn-sm btn-outline-danger" id="bulkDeleteBtn" onclick="bulkDeleteSelectedProducts()" data-i18n="buttons.bulk_delete">Hapus Terpilih</button>
                                <button class="btn btn-sm btn-danger" id="purgeAllProductsBtn" onclick="purgeAllProducts()" title="Hapus semua produk dari database. Sangat berbahaya, pastikan sudah backup." style="display:none;">
                                    <i class="bi bi-exclamation-triangle"></i> Hapus Semua Produk
                                </button>
                            </div>
                        </div>

                        <!-- Pagination di tengah atas tabel -->
                        <div class="d-flex justify-content-center mb-2">
                            <nav id="paginationTop">
                            </nav>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead><tr><th><input type="checkbox" id="selectAllProducts"></th><th>No</th><th>ID</th><th data-i18n="products.sku">SKU</th><th data-i18n="products.name">Nama</th><th data-i18n="products.category">Kategori</th><th data-i18n="products.purchase_price">Harga Beli</th><th data-i18n="products.selling_price">Harga Jual</th><th>Selisih</th><th data-i18n="products.tax_rate">Tax (%)</th><th data-i18n="products.discount_percent">Discount (%)</th><th data-i18n="products.qr_code">QR Code</th><th>Tgl Exp</th><th data-i18n="products.stock">Stok</th><th data-i18n="products.badges">Badges</th><th data-i18n="products.actions.5">Aksi</th></tr></thead>
                                <tbody id="productTableBody"></tbody>
                            </table>
                        </div>

                        <!-- PERUBAHAN: Tambahkan kontrol pagination di bawah -->
                        <div class="d-flex justify-content-center">
                            <nav id="paginationBottom">
                                <!-- Pagination buttons will be generated by JavaScript -->
                            </nav>
                        </div>
                    </div>

                    <!-- Categories View -->
<div id="categories-view" class="view-content" style="display:none;">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h2 data-i18n="categories.title">Kelola Kategori</h2>
        <div>
            <button class="btn btn-success me-2" id="exportCategoriesBtn">
                <i class="bi bi-download"></i> Export ke XLSX
            </button>
            <button class="btn btn-info me-2" id="downloadCategoryTemplateBtn">
                <i class="bi bi-file-earmark-spreadsheet"></i> Unduh Template
            </button>
            
            <div class="btn-group me-2" role="group">
                <button class="btn btn-secondary" id="chooseCategoryFileBtn">
                    <i class="bi bi-folder-open"></i> Pilih File
                </button>
                <button class="btn btn-warning" id="importCategoryFileBtn" disabled>
                    <i class="bi bi-upload"></i> Impor Sekarang
                </button>
            </div>
            <small class="text-muted me-3" id="selectedCategoryFileName">Tidak ada file yang dipilih</small>
            
            <input type="file" id="importCategoryFileInput" accept=".xlsx" style="display: none;">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#categoryModal" data-action="add" data-i18n="categories.add_category">Tambah Kategori</button>
        </div>
    </div>
    
    <!-- Tambahkan Pencarian Kategori -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input type="text" class="form-control" id="categorySearchInput" data-i18n-placeholder="categories.search_placeholder" placeholder="Cari berdasarkan nama kategori...">
                <button class="btn btn-outline-secondary" type="button" id="clearCategorySearchBtn" data-i18n="products.clear">Hapus</button>
            </div>
        </div>
    </div>

    <!-- Tambahkan Kontrol Pagination di Atas -->
    <div class="d-flex justify-content-between align-items-center mb-2">
        <div>
            <span data-i18n="products.show">Tampilkan</span> 
            <select class="form-select d-inline-block w-auto" id="categoryPageSizeSelect">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="all">Semua</option>
            </select>
            <span data-i18n="products.entries">data</span>
        </div>
    </div>

    <!-- Pagination di tengah atas tabel -->
    <div class="d-flex justify-content-center mb-2">
        <nav id="categoryPaginationTop">
            <!-- Pagination buttons will be generated by JavaScript -->
        </nav>
    </div>

    <div class="table-responsive">
        <table class="table table-striped">
            <thead><tr><th>No</th><th>ID</th><th data-i18n="categories.name">Nama</th><th data-i18n="categories.description">Deskripsi</th><th data-i18n="categories.product_count">Jumlah Produk</th><th data-i18n="categories.actions.1">Aksi</th></tr></thead>
            <tbody id="categoryTableBody"></tbody>
        </table>
    </div>

    <!-- Tambahkan Kontrol Pagination di Bawah -->
    <div class="d-flex justify-content-center">
        <nav id="categoryPaginationBottom">
            <!-- Pagination buttons will be generated by JavaScript -->
        </nav>
    </div>
  
  <!-- Units (Satuan) Management under Categories -->
  <div class="mt-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-2 pb-2 mb-3 border-bottom">
          <h3 class="h5 mb-0">Kelola Satuan</h3>
          <div>
              <button class="btn btn-success me-2" id="exportUnitsBtn">
                  <i class="bi bi-download"></i> Export ke XLSX
              </button>
              <button class="btn btn-info me-2" id="downloadUnitTemplateBtn">
                  <i class="bi bi-file-earmark-spreadsheet"></i> Unduh Template
              </button>
              <div class="btn-group me-2" role="group">
                  <button class="btn btn-secondary" id="chooseUnitFileBtn">
                      <i class="bi bi-folder-open"></i> Pilih File
                  </button>
                  <button class="btn btn-warning" id="importUnitFileBtn" disabled>
                      <i class="bi bi-upload"></i> Impor Sekarang
                  </button>
              </div>
              <small class="text-muted me-3" id="selectedUnitFileName">Tidak ada file yang dipilih</small>
              <input type="file" id="importUnitFileInput" accept=".xlsx" style="display: none;">
              <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#unitModal" data-action="add">Tambah Satuan</button>
          </div>
      </div>
      <div class="row mb-3">
          <div class="col-md-6">
              <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-search"></i></span>
                  <input type="text" class="form-control" id="unitSearchInput" placeholder="Cari berdasarkan nama satuan...">
                  <button class="btn btn-outline-secondary" type="button" id="clearUnitSearchBtn">Hapus</button>
              </div>
          </div>
      </div>
      <div class="d-flex justify-content-between align-items-center mb-2">
          <div>
              <span>Tampilkan</span>
              <select class="form-select d-inline-block w-auto" id="unitPageSizeSelect">
                  <option value="5">5</option>
                  <option value="10" selected>10</option>
                  <option value="25">25</option>
                  <option value="50">50</option>
                  <option value="all">Semua</option>
              </select>
              <span>data</span>
          </div>
      </div>
      <div class="d-flex justify-content-center mb-2">
          <nav id="unitPaginationTop"></nav>
      </div>
      <div class="table-responsive">
          <table class="table table-striped">
              <thead><tr><th>No</th><th>ID</th><th>Nama</th><th>Deskripsi</th><th>Aksi</th></tr></thead>
              <tbody id="unitTableBody"></tbody>
          </table>
      </div>
      <div class="d-flex justify-content-center">
          <nav id="unitPaginationBottom"></nav>
      </div>
  </div>
</div>

<!-- Unit Modal -->
<div class="modal fade" id="unitModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Kelola Satuan</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="unitForm">
          <input type="hidden" id="unitId">
          <div class="mb-3">
            <label class="form-label">Nama Satuan <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="unitName" required placeholder="mis. pcs, box, goni">
          </div>
          <div class="mb-3">
            <label class="form-label">Deskripsi</label>
            <input type="text" class="form-control" id="unitDescription" placeholder="opsional">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button type="button" class="btn btn-primary" id="saveUnitBtn">Simpan</button>
      </div>
    </div>
  </div>
</div>
</div>

<!-- Transactions View -->
<div id="transactions-view" class="view-content" style="display:none;">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h2 data-i18n="transactions.title">Kelola Transaksi</h2>
        <div>
            <button class="btn btn-success me-2" id="exportTransactionsBtn" data-i18n="transactions.export_xlsx">
                <i class="bi bi-download"></i> Export ke XLSX
            </button>
            <button class="btn btn-info me-2" data-i18n="transactions.filter_date">
                <i class="bi bi-calendar-range"></i> Filter Tanggal
            </button>
        </div>
    </div>

    <!-- Tambahkan Pencarian Transaksi -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input type="text" class="form-control" id="transactionSearchInput" data-i18n-placeholder="transactions.search_placeholder" placeholder="Cari berdasarkan ID, tanggal, kasir, atau total...">
                <button class="btn btn-outline-secondary" type="button" id="clearTransactionSearchBtn" data-i18n="products.clear">Hapus</button>
            </div>
        </div>
        <div class="col-md-3">
            <select class="form-select" id="paymentMethodFilter">
                <option value="" data-i18n="transactions.all_methods">Semua Metode</option>
                <option value="cash" data-i18n="transactions.cash">Tunai</option>
                <option value="qris" data-i18n="transactions.qris">QRIS</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-select" id="dateRangeFilter">
                <option value="" data-i18n="buttons.all">Semua Tanggal</option>
                <option value="today" data-i18n="transactions.today">Hari Ini</option>
                <option value="week" data-i18n="transactions.this_week">Minggu Ini</option>
                <option value="month" data-i18n="transactions.this_month">Bulan Ini</option>
                <option value="custom" data-i18n="transactions.custom_range">Custom Range</option>
            </select>
        </div>
    </div>

    <!-- Tambahkan Kontrol Pagination di Atas -->
    <div class="d-flex justify-content-between align-items-center mb-2">
        <div>
            <span data-i18n="products.show">Tampilkan</span> 
            <select class="form-select d-inline-block w-auto" id="transactionPageSizeSelect">
                <option value="10" selected>10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
                <option value="all">Semua</option>
            </select>
            <span data-i18n="products.entries">data</span>
        </div>
    </div>

    <!-- Pagination di tengah atas tabel -->
    <div class="d-flex justify-content-center mb-2">
        <nav id="transactionPaginationTop">
            <!-- Pagination buttons will be generated by JavaScript -->
        </nav>
    </div>

    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th data-i18n="transactions.id_header">No</th>
                    <th data-i18n="transactions.id_header">ID</th>
                    <th data-i18n="transactions.date_header">Tanggal & Waktu</th>
                    <th data-i18n="transactions.cashier_header">Kasir</th>
                    <th data-i18n="transactions.items_header">Item</th>
                    <th data-i18n="transactions.total_header">Total</th>
                    <th data-i18n="transactions.method_header">Metode</th>
                    <th data-i18n="transactions.status_header">Status</th>
                    <th data-i18n="transactions.actions_header">Aksi</th>
                </tr>
            </thead>
            <tbody id="transactionTableBody"></tbody>
        </table>
    </div>

    <!-- Tambahkan Kontrol Pagination di Bawah -->
    <div class="d-flex justify-content-between align-items-center mt-2">
        <div id="transactionSummary" class="text-muted">
            <!-- Summary will be generated by JavaScript -->
        </div>
        <nav id="transactionPaginationBottom" class="justify-content-center">
            <!-- Pagination buttons will be generated by JavaScript -->
        </nav>
    </div>
</div>

<!-- Transaction Details Modal -->
<div class="modal fade" id="transactionDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Detail Transaksi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="transactionDetailsContent">
                    <!-- Details will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                <button type="button" class="btn btn-primary" id="printTransactionBtn">
                    <i class="bi bi-printer"></i> Cetak Struk
                </button>
                <button type="button" class="btn btn-danger" id="voidTransactionBtn">Void Transaksi</button>
            </div>
        </div>
    </div>
</div>

<!-- Date Range Modal -->
<div class="modal fade" id="dateRangeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Filter Tanggal Transaksi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="startDate" class="form-label">Tanggal Mulai</label>
                    <input type="date" class="form-control" id="startDate">
                </div>
                <div class="mb-3">
                    <label for="endDate" class="form-label">Tanggal Selesai</label>
                    <input type="date" class="form-control" id="endDate">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                <button type="button" class="btn btn-primary" id="applyDateFilterBtn">Terapkan Filter</button>
            </div>
        </div>
    </div>
</div>

<!-- Users View -->
<div id="users-view" class="view-content" style="display:none;">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h2 data-i18n="users.title">Kelola User</h2>
        <div>
            <button class="btn btn-success me-2" id="exportUsersBtn">
                <i class="bi bi-download"></i> Export ke XLSX
            </button>
            <button class="btn btn-info me-2" id="downloadUserTemplateBtn">
                <i class="bi bi-file-earmark-spreadsheet"></i> Unduh Template
            </button>
            
            <div class="btn-group me-2" role="group">
                <button class="btn btn-secondary" id="chooseUserFileBtn">
                    <i class="bi bi-folder-open"></i> Pilih File
                </button>
                <button class="btn btn-warning" id="importUserFileBtn" disabled>
                    <i class="bi bi-upload"></i> Impor Sekarang
                </button>
            </div>
            <small class="text-muted me-3" id="selectedUserFileName">Tidak ada file yang dipilih</small>
            
            <input type="file" id="importUserFileInput" accept=".xlsx" style="display: none;">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#userModal" data-action="add" data-i18n="users.add_user">Tambah User</button>
        </div>
    </div>
    
    <!-- Tambahkan Pencarian User -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input type="text" class="form-control" id="userSearchInput" data-i18n-placeholder="users.search_placeholder" placeholder="Cari berdasarkan username, nama, atau role...">
                <button class="btn btn-outline-secondary" type="button" id="clearUserSearchBtn" data-i18n="products.clear">Hapus</button>
            </div>
        </div>
        <div class="col-md-3">
            <select class="form-select" id="roleFilter">
                <option value="" data-i18n="buttons.all">Semua Role</option>
                <option value="admin" data-i18n="users.admin">Admin</option>
                <option value="cashier" data-i18n="users.cashier">Kasir</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-select" id="statusFilter">
                <option value="" data-i18n="buttons.all">Semua Status</option>
                <option value="active" data-i18n="users.active">Aktif</option>
                <option value="inactive" data-i18n="users.inactive">Tidak Aktif</option>
            </select>
        </div>
    </div>

    <!-- Tambahkan Kontrol Pagination di Atas -->
    <div class="d-flex justify-content-between align-items-center mb-2">
        <div>
            <span data-i18n="products.show">Tampilkan</span> 
            <select class="form-select d-inline-block w-auto" id="userPageSizeSelect">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="all">Semua</option>
            </select>
            <span data-i18n="products.entries">data</span>
        </div>
    </div>

    <!-- Pagination di tengah atas tabel -->
    <div class="d-flex justify-content-center mb-2">
        <nav id="userPaginationTop">
            <!-- Pagination buttons will be generated by JavaScript -->
        </nav>
    </div>

    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>No</th>
                    <th data-i18n="users.username">ID</th>
                    <th data-i18n="users.username">Username</th>
                    <th data-i18n="users.name">Nama Lengkap</th>
                    <th data-i18n="users.role">Role</th>
                    <th data-i18n="users.status">Status</th>
                    <th data-i18n="users.last_login">Terakhir Login</th>
                    <th data-i18n="users.actions.2">Aksi</th>
                </tr>
            </thead>
            <tbody id="userTableBody"></tbody>
        </table>
    </div>

    <!-- Tambahkan Kontrol Pagination di Bawah -->
    <div class="d-flex justify-content-between align-items-center mt-2">
        <div id="userSummary" class="text-muted">
            <!-- Summary will be generated by JavaScript -->
        </div>
        <nav id="userPaginationBottom" class="justify-content-center">
            <!-- Pagination buttons will be generated by JavaScript -->
        </nav>
    </div>
</div>

<!-- User Modal (Update dengan status field) -->
<div class="modal fade" id="userModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" data-i18n="users.edit_user">Kelola User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <input type="hidden" id="userId">
                    <div class="mb-3">
                        <label class="form-label" data-i18n="users.username">Username <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="userUsername" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" data-i18n="users.name">Nama Lengkap <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="userNameField" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" data-i18n="buttons.save">Password <span class="text-danger" id="passwordRequired">*</span></label>
                        <input type="password" class="form-control" id="userPassword">
                        <small class="form-text text-muted">Kosongkan jika tidak ingin mengubah password</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" data-i18n="users.role">Role <span class="text-danger">*</span></label>
                        <select class="form-control" id="userRole" required>
                            <option value="" data-i18n="users.select_role">Pilih Role</option>
                            <option value="cashier" data-i18n="users.cashier">Kasir</option>
                            <option value="admin" data-i18n="users.admin">Admin</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" data-i18n="users.status">Status</label>
                        <select class="form-control" id="userStatus">
                            <option value="active" data-i18n="users.active">Aktif</option>
                            <option value="inactive" data-i18n="users.inactive">Tidak Aktif</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="buttons.cancel">Batal</button>
                <button type="button" class="btn btn-primary" id="saveUserBtn" data-i18n="buttons.save">Simpan</button>
            </div>
        </div>
    </div>
</div>

<!-- Reset Password Modal -->
<div class="modal fade" id="resetPasswordModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" data-i18n="users.reset_password">Reset Password</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Reset password untuk user: <strong id="resetPasswordUsername"></strong></p>
                <div class="mb-3">
                    <label class="form-label" data-i18n="users.new_password">Password Baru <span class="text-danger">*</span></label>
                    <input type="password" class="form-control" id="newPassword" required>
                </div>
                <div class="mb-3">
                    <label class="form-label" data-i18n="users.confirm_password">Konfirmasi Password <span class="text-danger">*</span></label>
                    <input type="password" class="form-control" id="confirmPassword" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="buttons.cancel">Batal</button>
                <button type="button" class="btn btn-warning" id="confirmResetPasswordBtn" data-i18n="users.reset_password">Reset Password</button>
            </div>
        </div>
    </div>
</div>

                    <!-- Settings View -->
                    <div id="settings-view" class="view-content" style="display:none;">
                        <h2 data-i18n="settings.title">Pengaturan Aplikasi</h2>
                        <form id="settingsForm">
                            <div class="mb-3">
                                <label for="storeName" class="form-label" data-i18n="settings.store_name">Nama Toko</label>
                                <input type="text" class="form-control" id="storeName" placeholder="Mis. Toko Sukses Selalu">
                            </div>
                            <div class="mb-3">
                                <label for="settingsLogoFile" class="form-label" data-i18n="settings.logo">Logo Toko (Upload atau Base64)</label>
                                <input type="file" class="form-control" id="settingsLogoFile" accept="image/*">
                                <small class="form-text text-muted">Gunakan gambar rasio persegi atau landscape kecil. Maks 1MB.</small>
                                <textarea class="form-control mt-2" id="settingsLogoBase64" rows="2" placeholder="Atau tempel string Data URL Base64 di sini..."></textarea>
                                <img id="settingsLogoPreview" src="" alt="Preview" class="img-fluid mt-2" style="max-height: 80px; display:none;">
                            </div>
                            <div class="mb-3">
                                <label for="settingsFaviconFile" class="form-label">Favicon (Upload atau Base64)</label>
                                <input type="file" class="form-control" id="settingsFaviconFile" accept="image/*">
                                <small class="form-text text-muted">Gunakan gambar kecil (32x32 atau 64x64). Maks 1MB.</small>
                                <textarea class="form-control mt-2" id="settingsFaviconBase64" rows="2" placeholder="Atau tempel string Data URL Base64 di sini..."></textarea>
                                <img id="settingsFaviconPreview" src="" alt="Preview" class="img-fluid mt-2" style="max-height: 64px; display:none;">
                            </div>
                            <div class="mb-3">
                                <label for="receiptFooter" class="form-label" data-i18n="settings.receipt_footer">Catatan Struk</label>
                                <textarea class="form-control" id="receiptFooter" rows="2" data-i18n-placeholder="users.thank_you_message" placeholder="Terima kasih telah berbelanja!"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="receiptFooter1" class="form-label" data-i18n="settings.receipt_footer1">Catatan Struk 1</label>
                                <textarea class="form-control" id="receiptFooter1" rows="2" data-i18n-placeholder="settings.receipt_footer1_placeholder" placeholder="Catatan struk tambahan..."></textarea>
                            </div>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label" for="taxRate" data-i18n="settings.tax_rate">Pajak (%)</label>
                                    <input type="number" step="0.01" min="0" class="form-control" id="taxRate" placeholder="0">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" for="serviceRate" data-i18n="settings.service_rate">Service (%)</label>
                                    <input type="number" step="0.01" min="0" class="form-control" id="serviceRate" placeholder="0">
                                </div>
                                <div class="col-md-4 d-flex align-items-end">
                                    <div class="form-check mt-4">
                                        <input class="form-check-input" type="checkbox" id="priceIncludesTax">
                                        <label class="form-check-label" for="priceIncludesTax">Harga sudah termasuk pajak</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row g-3 mt-1">
                                <div class="col-md-4">
                                    <label class="form-label" for="currencySymbol" data-i18n="settings.currency">Simbol Mata Uang</label>
                                    <input type="text" class="form-control" id="currencySymbol" placeholder="Rp">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label" for="thousandSeparator" data-i18n="settings.thousand_separator">Pemisah Ribuan</label>
                                    <input type="text" class="form-control" id="thousandSeparator" placeholder=".">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label" for="decimalSeparator" data-i18n="settings.decimal_separator">Pemisah Desimal</label>
                                    <input type="text" class="form-control" id="decimalSeparator" placeholder=",">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label" for="currencyPrecision">Presisi</label>
                                    <select class="form-select" id="currencyPrecision">
                                        <option value="0">0</option>
                                        <option value="2">2</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="storeAddress" class="form-label" data-i18n="settings.address">Alamat</label>
                                <textarea class="form-control" id="storeAddress" rows="2" placeholder="Alamat toko..."></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="storePhone" class="form-label" data-i18n="settings.phone">Telepon</label>
                                <input type="text" class="form-control" id="storePhone" placeholder="08xxxxxxxxxx">
                            </div>
                            <hr>
                            <h5 data-i18n="settings.theme">Tema</h5>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label" for="themeColor" data-i18n="settings.theme_color">Warna Tema (Primary)</label>
                                    <input type="color" class="form-control form-control-color" id="themeColor" value="#198754" title="Pilih warna utama">
                                </div>
                            </div>

                            <hr>
                            <h5 data-i18n="settings.receipt_options">Opsi Struk</h5>
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <div class="form-check mt-4">
                                        <input class="form-check-input" type="checkbox" id="showReceiptAddress" checked>
                                        <label class="form-check-label" for="showReceiptAddress" data-i18n="settings.show_address">Tampilkan Alamat</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check mt-4">
                                        <input class="form-check-input" type="checkbox" id="showReceiptPhone" checked>
                                        <label class="form-check-label" for="showReceiptPhone" data-i18n="settings.show_phone">Tampilkan Telepon</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check mt-4">
                                        <input class="form-check-input" type="checkbox" id="showReceiptFooter" checked>
                                        <label class="form-check-label" for="showReceiptFooter" data-i18n="settings.show_footer">Tampilkan Footer</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label" for="paperWidth" data-i18n="settings.paper_width">Lebar Kertas</label>
                                    <select class="form-select" id="paperWidth">
                                        <option value="48">48 mm</option>
                                        <option value="58">58 mm</option>
                                        <option value="76">76 mm</option>
                                        <option value="80">80 mm</option>
                                        <option value="100">100 mm</option>
                                    </select>
                                    <small class="form-text text-muted">Ukuran kertas untuk struk. Ukuran font akan menyesuaikan otomatis.</small>
                                </div>
                            </div>

                            <hr>
                            <h5 data-i18n="settings.branding_login">Branding Login</h5>
                            <div class="mb-3">
                                <label for="loginTitle" class="form-label" data-i18n="settings.login_title">Judul Login</label>
                                <input type="text" class="form-control" id="loginTitle" placeholder="Mis. POS Login">
                            </div>
                            <div class="mb-3">
                                <label for="loginLogoFile" class="form-label" data-i18n="settings.login_logo">Logo Login (Upload atau Base64)</label>
                                <input type="file" class="form-control" id="loginLogoFile" accept="image/*">
                                <small class="form-text text-muted">Gunakan gambar kecil. Maks 1MB.</small>
                                <textarea class="form-control mt-2" id="loginLogoBase64" rows="2" placeholder="Atau tempel string Data URL Base64 di sini..."></textarea>
                                <img id="loginLogoPreview" src="" alt="Preview" class="img-fluid mt-2" style="max-height: 80px; display:none;">
                            </div>
                            <div class="mb-3">
                                <label for="loginBackgroundFile" class="form-label" data-i18n="settings.login_background">Background Login (Upload atau Base64)</label>
                                <input type="file" class="form-control" id="loginBackgroundFile" accept="image/*">
                                <small class="form-text text-muted">Opsional. Maks 1MB.</small>
                                <textarea class="form-control mt-2" id="loginBackgroundBase64" rows="2" placeholder="Atau tempel string Data URL Base64 di sini..."></textarea>
                                <img id="loginBackgroundPreview" src="" alt="Preview" class="img-fluid mt-2" style="max-height: 120px; display:none;">
                            </div>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label" for="loginLogoSize" data-i18n="settings.login_logo_size">Ukuran Logo Login</label>
                                    <select class="form-select" id="loginLogoSize">
                                        <option value="small" data-i18n="settings.small">Kecil</option>
                                        <option value="medium" selected data-i18n="settings.medium">Sedang</option>
                                        <option value="large" data-i18n="settings.large">Besar</option>
                                    </select>
                                </div>
                                <div class="col-md-4 d-flex align-items-end">
                                    <!-- Dark mode moved to navbar -->
                                </div>
                            </div>
                            <div class="card mt-3">
                                <div class="card-body">
                                    <h5 class="card-title">Produk</h5>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="allowDuplicateSku">
                                        <label class="form-check-label" for="allowDuplicateSku">Ijinkan SKU ganda</label>
                                    </div>
                                    <div class="form-check form-switch mt-2">
                                        <input class="form-check-input" type="checkbox" id="allowDuplicateProductNames">
                                        <label class="form-check-label" for="allowDuplicateProductNames">Ijinkan nama produk ganda</label>
                                    </div>
                                    <div class="form-check form-switch mt-2">
                                        <input class="form-check-input" type="checkbox" id="showPurgeAllProducts">
                                        <label class="form-check-label" for="showPurgeAllProducts">Tampilkan tombol "Hapus Semua Produk" di halaman produk</label>
                                    </div>
                                    <div class="mt-3">
                                        <button type="button" class="btn btn-warning" id="removeDuplicateProductsBtn">
                                            <i class="bi bi-trash"></i> Hapus Produk Ganda (Nama Sama)
                                        </button>
                                        <small class="text-muted d-block mt-1">Menghapus produk dengan nama yang sama persis, menyisakan satu produk tertua.</small>
                                        
                                        <!-- Progress Bar for Duplicate Removal -->
                                        <div id="removeDuplicatesProgressContainer" style="display: none;" class="mt-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="small text-muted">Proses Hapus Produk Ganda</span>
                                                <span id="removeDuplicatesProgressText" class="small fw-bold">0%</span>
                                            </div>
                                            <div class="progress" style="height: 25px; background-color: #e9ecef; border-radius: 12px; overflow: hidden;">
                                                <div id="removeDuplicatesProgressBar" class="progress-bar progress-bar-striped progress-bar-animated" style="height: 100%; background: linear-gradient(90deg, rgba(255, 193, 7, 1), rgba(255, 152, 0, 1) 100%); border-radius: 12px; display: flex; justify-content: center; align-items: center; color: white; font-weight: bold; font-size: 12px;">
                                                    0%
                                                </div>
                                            </div>
                                            <div id="removeDuplicatesStatusText" class="small text-muted mt-2">Memulai proses...</div>
                                        </div>
                                    </div>
                                    <small class="text-muted">Jika diaktifkan, sistem tidak akan menolak SKU yang sama pada produk berbeda.</small>
                                </div>
                            </div>
                            <div class="card mt-3">
                                <div class="card-body">
                                    <h5 class="card-title">Keamanan Data</h5>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="encryptionEnabled">
                                        <label class="form-check-label" for="encryptionEnabled">Aktifkan enkripsi database (butuh passphrase server)</label>
                                    </div>
                                    <small class="text-muted d-block mt-1">Jika diaktifkan, file JSON di folder data/ akan disimpan terenkripsi (ENC1) menggunakan passphrase server saat ini.</small>
                                    <small class="text-muted d-block">Setel atau ganti passphrase melalui halaman khusus admin-rekey.</small>
                                    
                                    <!-- VERY DANGEROUS: Delete All Database -->
                                    <div class="mt-4 p-3 border border-danger rounded bg-danger bg-opacity-10">
                                        <h6 class="text-danger mb-3">
                                            <i class="bi bi-exclamation-triangle-fill"></i> 
                                            ZONA BAHAYA - HAPUS SEMUA DATABASE
                                        </h6>
                                        <button type="button" class="btn btn-danger" id="deleteAllDatabaseBtn">
                                            <i class="bi bi-trash-fill"></i> Hapus Semua Database
                                        </button>
                                        <div class="small text-danger mt-2">
                                            <strong>PERINGATAN EXTREME:</strong> Ini akan menghapus SEMUA data aplikasi termasuk:
                                            <ul class="mb-0 mt-1">
                                                <li>Semua produk dan kategori</li>
                                                <li>Semua transaksi dan pembayaran</li>
                                                <li>Semua pelanggan dan supplier</li>
                                                <li>Semua pengguna (kecuali admin yang sedang login)</li>
                                                <li>Semua pengaturan dan backup</li>
                                                <li><strong>TIDAK BISA DIURUNGGI</strong></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card mt-3">
                                <div class="card-body">
                                    <h5 class="card-title">Halaman Kasir</h5>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="posShowBanner" checked>
                                        <label class="form-check-label" for="posShowBanner">Tampilkan banner di halaman kasir</label>
                                    </div>
                                    <small class="text-muted">Nonaktifkan untuk menyembunyikan banner promosi di halaman kasir.</small>
                                    <hr>
                                    <h6>Suara Notifikasi</h6>
                                    <div class="mb-3">
                                        <label for="cartSoundFile" class="form-label">Suara saat barang ditambahkan ke keranjang</label>
                                        <input type="file" class="form-control" id="cartSoundFile" accept="audio/*">
                                        <small class="form-text text-muted">Format yang didukung: MP3, WAV. Maks 500KB.</small>
                                        <div class="mt-2">
                                            <audio id="cartSoundPreview" controls style="display:none;"></audio>
                                        </div>
                                        <div class="form-check form-switch mt-2">
                                            <input class="form-check-input" type="checkbox" id="enableCartSound" checked>
                                            <label class="form-check-label" for="enableCartSound">Aktifkan suara notifikasi</label>
                                        </div>
                                    </div>
                                    <hr>
                                    <h6>Tampilan Produk</h6>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="posShowProductBorders" checked>
                                        <label class="form-check-label" for="posShowProductBorders">Tampilkan border pada kartu produk</label>
                                    </div>
                                    <small class="text-muted">Nonaktifkan untuk menyembunyikan border dekoratif pada kartu produk di halaman kasir.</small>
                                </div>
                            </div>

                            <div class="card mt-3" id="aiSettingsSection">
                                <div class="card-body">
                                    <h5 class="card-title">AI / Generatif</h5>
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label class="form-label" for="aiProvider">Provider</label>
                                            <select id="aiProvider" class="form-select">
                                                <option value="none">- Nonaktif -</option>
                                                <option value="openai">OpenAI (gpt-image-1)</option>
                                                <option value="gemini">Google Gemini</option>
                                                <option value="google">Google (Imagen/AI Studio)</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label" for="openaiApiKey">OpenAI API Key</label>
                                            <input type="password" class="form-control" id="openaiApiKey" placeholder="sk-...">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label" for="geminiApiKey">Gemini API Key</label>
                                            <input type="password" class="form-control" id="geminiApiKey" placeholder="AIza...">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label" for="googleApiKey">Google API Key</label>
                                            <input type="password" class="form-control" id="googleApiKey" placeholder="AIza...">
                                        </div>
                                    </div>
                                    <div class="row g-3 mt-1">
                                        <div class="col-md-4">
                                            <label class="form-label" for="aiImageSize">Ukuran Gambar</label>
                                            <select id="aiImageSize" class="form-select">
                                                <option value="256x256">256x256</option>
                                                <option value="512x512">512x512</option>
                                                <option value="1024x1024" selected>1024x1024</option>
                                            </select>
                                        </div>
                                        <div class="col-md-8">
                                            <small class="text-muted d-block">Catatan: Saat ini generasi gambar memakai OpenAI bila key tersedia. Dukungan Gemini untuk generasi gambar mungkin terbatas tergantung API.</small>
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <div class="alert alert-info py-2 mb-0">
                                            <div class="small"><b>Panduan pengisian:</b></div>
                                            <ul class="mb-0 small">
                                                <li><b>Provider = OpenAI</b>: isi <b>OpenAI API Key</b> (format <code>sk-...</code>). Ini yang saat ini didukung penuh.</li>
                                                <li><b>Provider = Google</b>: isi <b>Google API Key</b> (Google AI Studio/Imagen). Implementasi generate akan diaktifkan sesuai akses API Anda.</li>
                                                <li><b>Provider = Gemini</b>: belum didukung untuk generate gambar di versi ini.</li>
                                                <li>Perlu koneksi internet dan kredensial API yang valid/aktif (billing).</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="mt-3 text-end">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="bi bi-save"></i> Simpan Pengaturan
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- License View -->
                    <div id="license-view" class="view-content" style="display:none;">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h2 class="mb-0">Status Lisensi</h2>
                        </div>

                        <div class="row g-3">
                            <div class="col-lg-6">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3">Ringkasan Lisensi</h5>
                                        <div id="licenseStatusSummaryBox">
                                            <p class="text-muted mb-0">Memuat status lisensi...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-6">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3">LICENSE KEY</h5>
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <div id="licenseStatusAdminPage" class="small text-muted flex-grow-1 me-3"></div>
                                            <div class="btn-group btn-group-sm" role="group" aria-label="Aksi LICENSE KEY">
                                                <button class="btn btn-outline-primary" type="button" id="licenseToggleFormBtn">Ganti</button>
                                                <button class="btn btn-outline-danger" type="button" id="licenseDeleteBtnAdminPage">Hapus</button>
                                            </div>
                                        </div>
                                        <div id="licenseFormWrapper" class="mb-2" style="display:none;">
                                            <label for="licenseKeyInputAdminPage" class="form-label">LICENSE KEY baru</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="licenseKeyInputAdminPage" placeholder="Masukkan LICENSE KEY baru">
                                                <button class="btn btn-primary" type="button" id="licenseSaveBtnAdminPage">Simpan</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Languages View -->
                    <div id="languages-view" class="view-content" style="display:none;">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h2 data-i18n="languages.title">Kelola Bahasa</h2>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#languageModal" data-action="add" data-i18n="languages.add_language">Tambah Bahasa</button>
                        </div>
                                        <th data-i18n="languages.translation_count">Jumlah Terjemahan</th>
                                        <th data-i18n="languages.actions.3">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="languageTableBody">
                                    <!-- Languages will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

    <!-- Shifts View -->
    <div id="shifts-view" class="view-content" style="display:none;">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h2>Shift Kasir</h2>
        </div>
        <div class="row mb-3">
            <div class="col-md-4">
                <label class="form-label" for="shiftCashierFilter">Kasir</label>
                <select class="form-select" id="shiftCashierFilter">
                    <option value="">Semua Kasir</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label" for="shiftDateFrom">Tanggal Mulai</label>
                <input type="date" class="form-control" id="shiftDateFrom">
            </div>
            <div class="col-md-3">
                <label class="form-label" for="shiftDateTo">Tanggal Akhir</label>
                <input type="date" class="form-control" id="shiftDateTo">
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button class="btn btn-primary w-100" id="applyShiftFilterBtn">Terapkan</button>
            </div>
        </div>
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
                <span>Tampilkan</span>
                <select class="form-select d-inline-block w-auto" id="shiftPageSizeSelect">
                    <option value="10" selected>10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="all">Semua</option>
                </select>
                <span>data</span>
            </div>
        </div>
        <div class="d-flex justify-content-center mb-2">
            <nav id="shiftPaginationTop"></nav>
        </div>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Kasir</th>
                        <th>Dibuka</th>
                        <th>Ditutup</th>
                        <th>Saldo Awal</th>
                        <th>Penjualan Tunai</th>
                        <th>Penjualan Non-Tunai</th>
                        <th>Selisih Kas</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="shiftTableBody"></tbody>
            </table>
        </div>
        <div class="d-flex justify-content-between align-items-center mt-2">
            <div id="shiftSummary" class="text-muted"></div>
            <nav id="shiftPaginationBottom" class="justify-content-center"></nav>
        </div>
    </div>

    <!-- Customers View -->
    <div id="customers-view" class="view-content" style="display:none;">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h2 data-i18n="customers.title">Kelola Pelanggan</h2>
            <div>
                <button class="btn btn-success me-2" id="exportCustomersBtn">
                    <i class="bi bi-download"></i> Export ke XLSX
                </button>
                <button class="btn btn-info me-2" id="downloadCustomerTemplateBtn">
                    <i class="bi bi-file-earmark-spreadsheet"></i> Unduh Template
                </button>
                
                <div class="btn-group me-2" role="group">
                    <button class="btn btn-secondary" id="chooseCustomerFileBtn">
                        <i class="bi bi-folder-open"></i> Pilih File
                    </button>
                    <button class="btn btn-warning" id="importCustomerFileBtn" disabled>
                        <i class="bi bi-upload"></i> Impor Sekarang
                    </button>
                </div>
                <small class="text-muted me-3" id="selectedCustomerFileName">Tidak ada file yang dipilih</small>
                
                <input type="file" id="importCustomerFileInput" accept=".xlsx" style="display: none;">
                <button class="btn btn-primary" id="addCustomerBtn" data-i18n="customers.add_customer">Tambah Pelanggan</button>
            </div>
        </div>

        <!-- Tambahkan Pencarian Customer -->
        <div class="row mb-3">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="customerSearchInput" data-i18n-placeholder="customers.search_placeholder" placeholder="Cari berdasarkan nama, telepon, atau email...">
                    <button class="btn btn-outline-secondary" type="button" id="clearCustomerSearchBtn" data-i18n="products.clear">Hapus</button>
                </div>
            </div>
        </div>

        <!-- Tambahkan Kontrol Pagination di Atas -->
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
                <span data-i18n="products.show">Tampilkan</span> 
                <select class="form-select d-inline-block w-auto" id="customerPageSizeSelect">
                    <option value="5">5</option>
                    <option value="10" selected>10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="all">Semua</option>
                </select>
                <span data-i18n="products.entries">data</span>
            </div>
        </div>

        <!-- Pagination di tengah atas tabel -->
        <div class="d-flex justify-content-center mb-2">
            <nav id="customerPaginationTop">
                <!-- Pagination buttons will be generated by JavaScript -->
            </nav>
        </div>

        <div class="table-responsive">
            <table class="table table-striped">
                <thead><tr><th>No</th><th data-i18n="customers.name">Nama</th><th data-i18n="customers.phone">Telepon</th><th data-i18n="customers.email">Email</th><th data-i18n="customers.address">Alamat</th><th data-i18n="customers.created_date">Tanggal Dibuat</th><th data-i18n="customers.actions.1">Aksi</th></tr></thead>
                <tbody id="customerTableBody"></tbody>
            </table>
        </div>

        <!-- Tambahkan Kontrol Pagination di Bawah -->
        <div class="d-flex justify-content-between align-items-center mt-2">
            <div id="customerSummary" class="text-muted">
                <!-- Summary will be generated by JavaScript -->
            </div>
            <nav id="customerPaginationBottom" class="justify-content-center">
                <!-- Pagination buttons will be generated by JavaScript -->
            </nav>
        </div>
    </div>

    <!-- Customer Debts View -->
    <div id="customer-debts-view" class="view-content" style="display:none;">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h2>Hutang Customer</h2>
            <div>
                <button class="btn btn-success" id="addCustomerPaymentBtn">Bayar Hutang</button>
                <button class="btn btn-primary" id="refreshCustomerDebtsBtn">Refresh</button>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card border-danger">
                    <div class="card-body">
                        <h5 class="card-title text-danger">Total Piutang</h5>
                        <h3 id="totalCustomerDebt" class="text-danger">Rp 0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-warning">
                    <div class="card-body">
                        <h5 class="card-title text-warning">Piutang Jatuh Tempo</h5>
                        <h3 id="overdueCustomerDebt" class="text-warning">Rp 0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-info">
                    <div class="card-body">
                        <h5 class="card-title text-info">Jumlah Customer</h5>
                        <h3 id="customerDebtCount" class="text-info">0</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customer Debt List -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Daftar Piutang Customer</h5>
                <div class="input-group input-group-sm" style="max-width: 260px;">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="customerDebtSearchInput" placeholder="Cari customer...">
                    <button class="btn btn-outline-secondary" type="button" id="clearCustomerDebtSearchBtn">Hapus</button>
                </div>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div>
                        <span>Tampilkan</span>
                        <select class="form-select d-inline-block w-auto" id="customerDebtPageSizeSelect">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="all">Semua</option>
                        </select>
                        <span>data</span>
                    </div>
                    <div>
                        <select class="form-select form-select-sm d-inline-block" id="customerDebtFilterSelect" style="width: auto;">
                            <option value="all">Semua Piutang</option>
                            <option value="overdue">Jatuh Tempo</option>
                            <option value="paid">Lunas</option>
                            <option value="partial">Bayar Sebagian</option>
                        </select>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Customer</th>
                                <th>ID Transaksi</th>
                                <th>Tanggal</th>
                                <th>Total Tagihan</th>
                                <th>Dibayar</th>
                                <th>Sisa</th>
                                <th>Jatuh Tempo</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="customerDebtsTableBody">
                            <tr><td colspan="10" class="text-muted text-center">Memuat data...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-2">
                    <div id="customerDebtsSummary" class="text-muted"></div>
                    <nav id="customerDebtsPagination" class="justify-content-center"></nav>
                </div>
            </div>
        </div>
    </div>

    <!-- Suppliers & Stock-In View -->
    <div id="suppliers-view" class="view-content" style="display:none;">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h2>Supplier &amp; Barang Masuk</h2>
            <div>
                <button class="btn btn-primary" id="addSupplierBtn">Tambah Supplier</button>
            </div>
        </div>

        <!-- Daftar Supplier -->
        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Daftar Supplier</h5>
                <div class="input-group input-group-sm" style="max-width: 260px;">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="supplierSearchInput" placeholder="Cari nama / telepon supplier...">
                    <button class="btn btn-outline-secondary" type="button" id="clearSupplierSearchBtn">Hapus</button>
                </div>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div>
                        <span>Tampilkan</span>
                        <select class="form-select d-inline-block w-auto" id="supplierPageSizeSelect">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="all">Semua</option>
                        </select>
                        <span>data</span>
                    </div>
                </div>
                <div class="d-flex justify-content-center mb-2">
                    <nav id="supplierPaginationTop"></nav>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama Supplier</th>
                                <th>Telepon</th>
                                <th>Alamat</th>
                                <th>Catatan</th>
                                <th>Tanggal Dibuat</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="supplierTableBody"></tbody>
                    </table>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-2">
                    <div id="supplierSummary" class="text-muted"></div>
                    <nav id="supplierPaginationBottom" class="justify-content-center"></nav>
                </div>
            </div>
        </div>

        <!-- Form Barang Masuk (Stock-In) -->
        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Catat Barang Masuk</h5>
                <button type="button" class="btn btn-sm btn-outline-primary" id="openProductModalFromStockInBtn">
                    <i class="bi bi-plus-circle"></i> Tambah Produk Baru
                </button>
            </div>
            <div class="card-body">
                <form id="stockInForm">
                    <div class="row g-3 mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Tanggal</label>
                            <input type="date" class="form-control" id="stockInDate">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Supplier</label>
                            <select class="form-select" id="stockInSupplierSelect">
                                <option value="">Pilih Supplier...</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Catatan</label>
                            <input type="text" class="form-control" id="stockInNote" placeholder="No faktur / keterangan lain">
                        </div>
                    </div>
                    <div class="row g-3 mb-3">
                        <div class="col-md-3">
                            <label class="form-label">Total Tagihan</label>
                            <input type="number" class="form-control" id="stockInTotalAmount" readonly>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Uang Dibayar</label>
                            <input type="number" class="form-control" id="stockInPaidAmount" placeholder="0" min="0">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Sisa</label>
                            <input type="number" class="form-control" id="stockInRemainingAmount" readonly>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Tanggal Bayar</label>
                            <input type="date" class="form-control" id="stockInPaymentDate">
                        </div>
                    </div>
                    <div class="table-responsive mb-2">
                        <table class="table table-sm align-middle" id="stockInItemsTable">
                            <thead>
                                <tr>
                                    <th style="width: 35%;">Produk</th>
                                    <th style="width: 15%;">Qty</th>
                                    <th style="width: 25%;">Harga Beli</th>
                                    <th style="width: 15%;">Subtotal</th>
                                    <th style="width: 10%;">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="stockInItemsBody">
                                <!-- Baris item akan diisi via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <button type="button" class="btn btn-sm btn-outline-secondary" id="addStockInItemBtn">
                            <i class="bi bi-plus-circle"></i> Tambah Baris
                        </button>
                        <div class="text-end">
                            <div><strong>Total Qty: </strong><span id="stockInTotalQty">0</span></div>
                        </div>
                    </div>
                    <div class="mt-3 text-end">
                        <button type="submit" class="btn btn-success" id="saveStockInBtn">Simpan Barang Masuk</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Riwayat Barang Masuk -->
        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Riwayat Barang Masuk</h5>
                <small class="text-muted">Data diambil dari transaksi barang masuk</small>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th style="width: 4%;">No</th>
                                <th style="width: 12%;">Tanggal</th>
                                <th style="width: 16%;">Supplier</th>
                                <th style="width: 8%;">Jumlah Item</th>
                                <th style="width: 8%;">Total Qty</th>
                                <th style="width: 24%;">Produk</th>
                                <th style="width: 10%;">Tagihan</th>
                                <th style="width: 10%;">Dibayar</th>
                                <th style="width: 10%;">Sisa</th>
                                <th style="width: 12%;">Tgl Bayar</th>
                                <th style="width: 10%;">Catatan</th>
                            </tr>
                        </thead>
                        <tbody id="stockInHistoryBody">
                            <tr><td colspan="11" class="text-muted text-center">Belum ada data barang masuk.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Credits & Debt View -->
    <div id="credits-view" class="view-content" style="display:none;">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h2>Kredit &amp; Hutang</h2>
            <div>
                <button class="btn btn-success" id="addPaymentBtn">Bayar Hutang</button>
                <button class="btn btn-primary" id="refreshCreditsBtn">Refresh</button>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card border-danger">
                    <div class="card-body">
                        <h5 class="card-title text-danger">Total Hutang</h5>
                        <h3 id="totalDebt" class="text-danger">Rp 0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-warning">
                    <div class="card-body">
                        <h5 class="card-title text-warning">Hutang Jatuh Tempo</h5>
                        <h3 id="overdueDebt" class="text-warning">Rp 0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-info">
                    <div class="card-body">
                        <h5 class="card-title text-info">Jumlah Supplier</h5>
                        <h3 id="supplierCount" class="text-info">0</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Debt List -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Daftar Hutang Supplier</h5>
                <div class="input-group input-group-sm" style="max-width: 260px;">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="creditSearchInput" placeholder="Cari supplier...">
                    <button class="btn btn-outline-secondary" type="button" id="clearCreditSearchBtn">Hapus</button>
                </div>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div>
                        <span>Tampilkan</span>
                        <select class="form-select d-inline-block w-auto" id="creditPageSizeSelect">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="all">Semua</option>
                        </select>
                        <span>data</span>
                    </div>
                    <div>
                        <select class="form-select form-select-sm d-inline-block" id="creditFilterSelect" style="width: auto;">
                            <option value="all">Semua Hutang</option>
                            <option value="overdue">Jatuh Tempo</option>
                            <option value="paid">Lunas</option>
                            <option value="partial">Bayar Sebagian</option>
                        </select>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Supplier</th>
                                <th>ID Transaksi</th>
                                <th>Tanggal</th>
                                <th>Total Tagihan</th>
                                <th>Dibayar</th>
                                <th>Sisa</th>
                                <th>Jatuh Tempo</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="creditsTableBody">
                            <tr><td colspan="10" class="text-muted text-center">Memuat data...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-2">
                    <div id="creditsSummary" class="text-muted"></div>
                    <nav id="creditsPagination" class="justify-content-center"></nav>
                </div>
            </div>
        </div>
    </div>

                    <!-- Banner View -->
                    <div id="banners-view" class="view-content" style="display:none;">
                        <h2 data-i18n="banners.title">Kelola Banner Homepage</h2>
                        <form id="bannerForm">
                            <div class="mb-3">
                                <label for="bannerTitle" class="form-label" data-i18n="banners.title_label">Judul</label>
                                <input type="text" class="form-control" id="bannerTitle" required>
                            </div>
                            <div class="mb-3">
                                <label for="bannerSubtitle" class="form-label" data-i18n="banners.subtitle">Subjudul</label>
                                <input type="text" class="form-control" id="bannerSubtitle">
                            </div>
                            <div class="mb-3">
                                <label for="bannerImage" class="form-label" data-i18n="banners.image">Gambar (Upload atau Base64)</label>
                                <input type="file" class="form-control" id="bannerImageFile" accept="image/*">
                                <small class="form-text text-muted">Direkomendasikan: Maksimal ukuran file 1MB. Gambar besar dapat memperlambat aplikasi.</small>
                                <textarea class="form-control mt-2" id="bannerImageBase64" rows="3" placeholder="Atau tempel string Base64 di sini..."></textarea>
                                <img id="bannerPreview" src="" alt="Preview" class="img-fluid mt-2" style="max-height: 200px; display:none;">
                            </div>
                            <button type="submit" class="btn btn-success" data-i18n="banners.update_banner">Update Banner</button>
                        </form>
                    </div>

                    <!-- QRIS View -->
                    <div id="qris-view" class="view-content" style="display:none;">
                        <h2 data-i18n="qris.title">Kelola Pembayaran QRIS</h2>
                        <p data-i18n="qris.description">Upload gambar QRIS yang akan ditampilkan kepada pelanggan saat checkout.</p>
                        <form id="qrisForm">
                            <hr>
                            <h6>Logo Metode Pembayaran</h6>
                            <div class="row g-3 mb-2">
                                <div class="col-md-4">
                                    <label class="form-label" for="paymentLogoQrisFile">Logo QRIS</label>
                                    <input type="file" class="form-control" id="paymentLogoQrisFile" accept="image/*">
                                    <small class="form-text text-muted">Opsional. Maks 1MB.</small>
                                    <textarea class="form-control form-control-sm mt-1" id="paymentLogoQrisBase64" rows="2" placeholder="Tempel Data URL base64 di sini (opsional)"></textarea>
                                    <button type="button" class="btn btn-sm btn-outline-danger mt-1" id="clearPaymentLogoQrisBtn">Hapus logo</button>
                                    <img id="paymentLogoQrisPreview" src="" alt="QRIS Logo" class="img-fluid mt-2" style="max-height:48px; display:none; object-fit:contain;">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" for="paymentLogoDanaFile">Logo DANA</label>
                                    <input type="file" class="form-control" id="paymentLogoDanaFile" accept="image/*">
                                    <small class="form-text text-muted">Opsional. Maks 1MB.</small>
                                    <textarea class="form-control form-control-sm mt-1" id="paymentLogoDanaBase64" rows="2" placeholder="Tempel Data URL base64 di sini (opsional)"></textarea>
                                    <button type="button" class="btn btn-sm btn-outline-danger mt-1" id="clearPaymentLogoDanaBtn">Hapus logo</button>
                                    <img id="paymentLogoDanaPreview" src="" alt="DANA Logo" class="img-fluid mt-2" style="max-height:48px; display:none; object-fit:contain;">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" for="paymentLogoOvoFile">Logo OVO</label>
                                    <input type="file" class="form-control" id="paymentLogoOvoFile" accept="image/*">
                                    <small class="form-text text-muted">Opsional. Maks 1MB.</small>
                                    <textarea class="form-control form-control-sm mt-1" id="paymentLogoOvoBase64" rows="2" placeholder="Tempel Data URL base64 di sini (opsional)"></textarea>
                                    <button type="button" class="btn btn-sm btn-outline-danger mt-1" id="clearPaymentLogoOvoBtn">Hapus logo</button>
                                    <img id="paymentLogoOvoPreview" src="" alt="OVO Logo" class="img-fluid mt-2" style="max-height:48px; display:none; object-fit:contain;">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success" data-i18n="qris.update_qris">Update Gambar QRIS</button>
                        </form>
                    </div>

                    <!-- Backup View -->
                    <div id="backup-view" class="view-content" style="display:none;">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <div>
                                <h2 class="mb-0" data-i18n="backup.title">Backup</h2>
                                <p class="mb-0" data-i18n="backup.description">Unduh cadangan database dan aplikasi untuk keamanan data Anda.</p>
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-body d-flex gap-2 flex-wrap">
                                <button class="btn btn-outline-primary" id="downloadDbBackupBtn" data-i18n="backup.backup_database"><i class="bi bi-hdd"></i> Backup Database (JSON)</button>
                                <button class="btn btn-outline-dark" id="downloadAppZipBtn"><i class="bi bi-file-zip"></i> Backup Aplikasi (ZIP)</button>
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-body d-flex gap-2 flex-wrap align-items-center">
                                <button class="btn btn-danger" id="restoreDbBtn" data-i18n="backup.restore_database"><i class="bi bi-upload"></i> Restore Database</button>
                                <input type="file" id="restoreDbFile" accept=".enc,.json,.txt,application/json,text/plain" class="form-control w-auto">
                                <small class="text-muted">Pilih file backup (.enc terenkripsi atau .json). Operasi ini akan menimpa file di folder data/.</small>
                            </div>
                            
                            <!-- Progress Bar for Restore -->
                            <div id="restoreProgressContainer" style="display: none;" class="mt-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="small text-muted">Proses Restore Database</span>
                                    <span id="restoreProgressText" class="small fw-bold">0%</span>
                                </div>
                                <div class="progress" style="height: 30px; background-color: #e9ecef; border-radius: 15px; overflow: hidden;">
                                    <div id="restoreProgressBar" class="progress-done" style="height: 100%; background: linear-gradient(90deg, rgba(220, 53, 69, 1), rgba(253, 126, 20, 1) 100%); border-radius: 15px; display: flex; justify-content: center; align-items: center; transform-origin: center left; box-shadow: 0 3px 3px -3px rgba(220, 53, 69, 1), 0px 2px 5px rgba(253, 126, 20, 1); color: white; font-weight: bold; transform: scaleX(0); opacity: 0.8; transition: all 0.3s ease;">
                                        0%
                                    </div>
                                </div>
                                <div id="restoreStatusText" class="small text-muted mt-2">Memulai proses restore...</div>
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-body">
                                <h5 class="card-title" data-i18n="backup.auto_backup_settings">Pengaturan Auto Backup</h5>
                                <div class="row g-3 align-items-end">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="autoBackupEnabled">
                                            <label class="form-check-label" for="autoBackupEnabled" data-i18n="backup.enable_auto_backup">Aktifkan Auto Backup</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label" for="autoBackupMode" data-i18n="backup.mode">Mode</label>
                                        <select id="autoBackupMode" class="form-select">
                                            <option value="off" data-i18n="backup.off">Mati</option>
                                            <option value="on_start" data-i18n="backup.on_start">Saat Aplikasi Start</option>
                                            <option value="daily" data-i18n="backup.daily">Sekali per Hari</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label" for="autoBackupRetention" data-i18n="backup.retention_days">Retensi (hari)</label>
                                        <input id="autoBackupRetention" type="number" class="form-control" value="7" min="0" step="1">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label" for="autoBackupMaxCount" data-i18n="backup.max_file_count">Maks. Jumlah File</label>
                                        <input id="autoBackupMaxCount" type="number" class="form-control" value="10" min="1" step="1">
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-primary w-100" id="saveAutoBackupBtn" data-i18n="backup.save_settings"><i class="bi bi-save"></i> Simpan Pengaturan</button>
                                    </div>
                                </div>
                                <small class="text-muted d-block mt-2">Backup otomatis akan disimpan ke folder backups/auto/. Retensi 0 = tanpa penghapusan otomatis.</small>
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="d-flex flex-wrap justify-content-between align-items-center mb-2 gap-2">
                                    <h5 class="card-title mb-0" data-i18n="backup.auto_backup_list">Daftar Auto Backup</h5>
                                    <div class="d-flex align-items-center gap-2 ms-auto">
                                        <div class="input-group input-group-sm" style="width: 240px;">
                                            <span class="input-group-text"><i class="bi bi-search"></i></span>
                                            <input type="text" class="form-control" id="autoBackupSearch" placeholder="Cari nama file...">
                                        </div>
                                        <button class="btn btn-sm btn-outline-primary" id="backupNowBtn" data-i18n="backup.backup_now"><i class="bi bi-hdd"></i> Backup Sekarang</button>
                                        <button class="btn btn-sm btn-outline-secondary" id="refreshAutoBackupListBtn" data-i18n="backup.refresh">Refresh</button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-sm table-striped">
                                        <thead>
                                            <tr>
                                                <th data-i18n="backup.file_name">Nama File</th>
                                                <th data-i18n="backup.file_size">Ukuran</th>
                                                <th data-i18n="backup.date_modified">Tanggal</th>
                                                <th data-i18n="backup.actions.4">Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody id="autoBackupTableBody">
                                            <tr><td colspan="4" class="text-muted">Memuat...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <small class="text-muted d-block mt-2" data-i18n="backup.note">Catatan: File berukuran besar (mis. gambar besar) dikecualikan dari backup aplikasi.</small>
                    </div>

    </div>
    <div class="modal fade" id="customerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="customerModalTitle" data-i18n="customers.edit_customer">Kelola Pelanggan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="customerForm">
                        <input type="hidden" id="customerId">
                        <div class="mb-3">
                            <label class="form-label" data-i18n="customers.name">Nama Pelanggan <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="customerName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label" data-i18n="customers.phone">Telepon</label>
                            <input type="text" class="form-control" id="customerPhone" placeholder="08xxxxxxxxxx">
                        </div>
                        <div class="mb-3">
                            <label class="form-label" data-i18n="customers.email">Email</label>
                            <input type="email" class="form-control" id="customerEmail" placeholder="email@example.com">
                        </div>
                        <div class="mb-3">
                            <label class="form-label" data-i18n="customers.address">Alamat</label>
                            <textarea class="form-control" id="customerAddress" rows="3" placeholder="Alamat lengkap pelanggan..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="buttons.cancel">Batal</button>
                    <button type="button" class="btn btn-primary" id="saveCustomerBtn" data-i18n="buttons.save">Simpan</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Category Modal -->
<div class="modal fade" id="categoryModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" data-i18n="categories.edit_category">Kelola Kategori</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="categoryForm">
                    <input type="hidden" id="categoryId">
                    <div class="mb-3">
                        <label class="form-label" data-i18n="categories.name">Nama Kategori <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="categoryName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" data-i18n="categories.description">Deskripsi</label>
                        <textarea class="form-control" id="categoryDescription"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="buttons.cancel">Batal</button>
                <button type="button" class="btn btn-primary" id="saveCategoryBtn" data-i18n="buttons.save">Simpan</button>
            </div>
        </div>
    </div>
</div>

<!-- Product Modal -->
<div class="modal fade" id="productModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" data-i18n="products.edit_product">Kelola Produk</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <input type="hidden" id="productId">
                    <div class="mb-3">
                        <label class="form-label" data-i18n="products.name">Nama Produk <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="productName" required>
                    </div>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label" data-i18n="products.purchase_price">Harga Beli</label>
                            <input type="number" step="0.01" min="0" class="form-control" id="productPurchasePrice" placeholder="0">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" data-i18n="products.selling_price">Harga Jual <span class="text-danger">*</span></label>
                            <input type="number" step="0.01" min="0" class="form-control" id="productPrice" required placeholder="0">
                        </div>
                    </div>
                    <div class="row g-3 mt-1">
                        <div class="col-md-4">
                            <label class="form-label" data-i18n="products.stock">Stok <span class="text-danger">*</span></label>
                            <input type="number" min="0" class="form-control" id="productStock" required placeholder="0">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label" data-i18n="products.tax_rate">Tax (%)</label>
                            <input type="number" step="0.01" min="0" class="form-control" id="productTaxRate" placeholder="0">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label" data-i18n="products.discount_percent">Discount (%)</label>
                            <input type="number" step="0.01" min="0" max="100" class="form-control" id="productDiscountPercent" placeholder="0">
                        </div>
                    </div>
                    <div class="mb-3 mt-1">
                        <label class="form-label">Tanggal Expired</label>
                        <input type="date" class="form-control" id="productExpiryDate">
                        <small class="text-muted">Opsional. Isi jika barang memiliki tanggal kadaluarsa.</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" data-i18n="products.category">Kategori</label>
                        <select class="form-control" id="productCategory">
                            <option value="">Pilih Kategori</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Satuan</label>
                        <div class="row g-2">
                            <div class="col-md-6">
                                <select class="form-control" id="productUnit">
                                    <option value="">Pilih Satuan</option>
                                    <option value="pcs">pcs</option>
                                    <option value="box">box</option>
                                    <option value="pack">pack</option>
                                    <option value="dus">dus</option>
                                    <option value="goni">goni</option>
                                    <option value="lusin">lusin</option>
                                    <option value="kg">kg</option>
                                    <option value="gram">gram</option>
                                    <option value="meter">meter</option>
                                    <option value="liter">liter</option>
                                    <option value="custom">Lainnya...</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <input type="text" class="form-control" id="productUnitCustom" placeholder="Isi satuan lain" style="display:none;">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Harga Varian (Opsional)</label>
                        <div class="table-responsive">
                            <table class="table table-sm align-middle">
                                <thead>
                                    <tr>
                                        <th style="width: 80px;">Gunakan</th>
                                        <th style="width: 120px;">Qty</th>
                                        <th style="width: 160px;">Satuan</th>
                                        <th style="width: 180px;">Harga</th>
                                        <th>Keterangan</th>
                                        <th style="width: 80px;">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="unitPricesBody"></tbody>
                            </table>
                        </div>
                        <button type="button" class="btn btn-outline-primary btn-sm" id="addUnitPriceRowBtn"><i class="bi bi-plus"></i> Tambah Varian Harga</button>
                        <small class="text-muted d-block mt-1">Contoh: 1 pcs = 1500, 3 pcs = 2500, 1 dus = 46000. Centang varian yang digunakan lalu isi harganya.</small>
                    </div>
                    <div class="row g-3 mt-1">
                        <div class="col-md-6">
                            <label class="form-label">Barcode/SKU</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="productSku" placeholder="Scan atau isi barcode SKU">
                                <button class="btn btn-outline-secondary" type="button" id="scanSkuBtn" title="Scan Kamera"><i class="bi bi-camera"></i></button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" data-i18n="products.qr_code">QR Code</label>
                        <label class="form-label" data-i18n="products.image">Gambar Produk (Upload atau Base64)</label>
                        <input type="file" class="form-control" id="productImageFile" accept="image/*" capture="environment">
                        <div class="d-flex gap-2 mt-2">
                            <button type="button" class="btn btn-outline-primary" id="productCaptureBtn"><i class="bi bi-camera"></i> Ambil Foto</button>
                            <button type="button" class="btn btn-outline-secondary" id="productGalleryBtn"><i class="bi bi-image"></i> Pilih dari Galeri</button>
                            <button type="button" class="btn btn-outline-success" id="generateProductImageBtn"><i class="bi bi-stars"></i> Generate Gambar (AI)</button>
                        </div>
                        <small class="form-text text-muted">Gunakan gambar rasio persegi atau landscape kecil. Maks 1MB.</small>
                        <textarea class="form-control mt-2" id="productImageBase64" rows="2" placeholder="Atau tempel string Data URL Base64 di sini..."></textarea>
                        <img id="productPreview" src="" alt="Preview" class="img-fluid mt-2" style="max-height: 200px; display:none;">
                    </div>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="productIsTop">
                                <label class="form-check-label" for="productIsTop">Produk Unggulan (TOP)</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="productIsBest">
                                <label class="form-check-label" for="productIsBest">Best Seller</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="buttons.cancel">Batal</button>
                <button type="button" class="btn btn-primary" id="saveProductBtn" data-i18n="buttons.save">Simpan</button>
            </div>
        </div>
    </div>
</div>

<!-- Product Camera Capture Modal -->
<div class="modal fade" id="productCameraModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-camera"></i> Ambil Foto Produk</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
            </div>
            <div class="modal-body">
                <video id="productCameraVideo" autoplay playsinline style="width:100%;max-height:60vh;background:#000"></video>
                <canvas id="productCameraCanvas" style="display:none;"></canvas>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" id="productSwitchCameraBtn"><i class="bi bi-arrow-repeat"></i> Ganti Kamera</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                <button type="button" class="btn btn-primary" id="takeProductPhotoBtn">Ambil</button>
            </div>
        </div>
    </div>
</div>

<!-- Language Modal -->
<div class="modal fade" id="languageModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Kelola Bahasa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="languageForm">
                    <input type="hidden" id="languageId">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label" data-i18n="languages.language_code">Kode Bahasa <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="languageCode" required placeholder="id, en, fr, etc.">
                            <small class="form-text text-muted">Kode bahasa ISO 2 karakter</small>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label" data-i18n="languages.language_name">Nama Bahasa <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="languageName" required placeholder="Bahasa Indonesia">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label" data-i18n="languages.flag_emoji">Emoji Bendera</label>
                            <input type="text" class="form-control" id="languageFlag" placeholder="">
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="languageActive" checked>
                            <label class="form-check-label" for="languageActive" data-i18n="languages.activate_language">Aktifkan bahasa ini</label>
                        </div>
                    </div>

                    <hr>
                    <h6 data-i18n="languages.translations">Terjemahan</h6>
                    <div class="alert alert-warning">
                        <small data-i18n="languages.new_language_note">Untuk bahasa baru, terjemahan akan disalin dari bahasa default (Bahasa Indonesia). Anda dapat mengeditnya setelah menyimpan.</small>
                    </div>

                    <div id="translationsContainer">
                        <!-- Translation fields will be generated here -->
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="buttons.cancel">Batal</button>
                <button type="button" class="btn btn-primary" id="saveLanguageBtn" data-i18n="buttons.save">Simpan</button>
            </div>
        </div>
    </div>
</div>
    
    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/admin.js?v=20251117"></script>
    <script src="/js/sidebar.js"></script>
    <script src="/js/back-to-top.js"></script>
    <script>
        (function () {
            async function loadTrialStatus() {
                try {
                    var el = document.getElementById('trialStatusBadge');
                    if (!el) return;
                    var resp = await fetch('/api/trial-status', { headers: { 'Accept': 'application/json' } });
                    if (!resp.ok) return;
                    var data = await resp.json();
                    if (data && data.enabled) {
                        el.style.display = '';
                        if (data.expired) {
                            el.textContent = 'Trial habis';
                            el.classList.remove('bg-warning', 'text-dark');
                            el.classList.add('bg-danger', 'text-light');
                        } else {
                            var mode = (data.mode || 'days').toString().toLowerCase();
                            if (mode === 'runs') {
                                var remainingRuns = typeof data.remainingRuns === 'number' ? data.remainingRuns : null;
                                var totalRuns = typeof data.totalRuns === 'number' ? data.totalRuns : null;
                                if (remainingRuns !== null && totalRuns !== null) {
                                    el.textContent = 'Trial buka: ' + remainingRuns + ' / ' + totalRuns + ' kali';
                                } else if (remainingRuns !== null) {
                                    el.textContent = 'Trial buka tersisa ' + remainingRuns + ' kali';
                                } else {
                                    var usedRuns = typeof data.usedRuns === 'number' ? data.usedRuns : (typeof data.runCount === 'number' ? data.runCount : null);
                                    if (usedRuns !== null && totalRuns) {
                                        el.textContent = 'Trial buka: ' + usedRuns + ' dari ' + totalRuns + ' kali';
                                    } else {
                                        el.textContent = 'Trial aktif (mode jumlah buka)';
                                    }
                                }
                            } else {
                                var remaining = typeof data.remainingDays === 'number' ? data.remainingDays : null;
                                var total = typeof data.totalDays === 'number' ? data.totalDays : null;
                                if (remaining !== null && total !== null) {
                                    el.textContent = 'Trial: ' + remaining + ' / ' + total + ' hari';
                                } else if (remaining !== null) {
                                    el.textContent = 'Trial sisa ' + remaining + ' hari';
                                } else {
                                    el.textContent = 'Trial aktif';
                                }
                            }
                        }
                        return;
                    }

                    // Trial non-aktif: cek license berbasis tanggal
                    try {
                        var respLic = await fetch('/api/license/status', { headers: { 'Accept': 'application/json' } });
                        if (!respLic.ok) { el.style.display = 'none'; return; }
                        var lic = await respLic.json();
                        var off = lic && lic.offline;
                        var rem = (lic && typeof lic.remainingDays === 'number') ? lic.remainingDays : null;
                        if (off && off.valid && rem !== null && rem >= 0) {
                            el.style.display = '';
                            el.classList.remove('bg-danger', 'text-light');
                            el.classList.add('bg-warning', 'text-dark');
                            el.textContent = 'License sisa ' + rem + ' hari';
                        } else {
                            el.style.display = 'none';
                        }
                    } catch (e2) {
                        el.style.display = 'none';
                    }
                } catch (e) {}
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', loadTrialStatus);
            } else {
                loadTrialStatus();
            }
        })();
    </script>
    <script>
        (function () {
            async function refreshLicenseAdmin() {
                try {
                    var card = document.getElementById('licenseCardAdmin');
                    var textEl = document.getElementById('licenseStatusAdminText');
                    if (!card || !textEl) return;
                    var resp = await fetch('/api/license/status', { headers: { 'Accept': 'application/json' } });
                    if (!resp.ok) return;
                    var data = await resp.json();
                    var off = data && data.offline;
                    var rem = (data && typeof data.remainingDays === 'number') ? data.remainingDays : null;
                    var type = (data && data.licenseType) ? String(data.licenseType) : 'none';
                    var runs = data && data.licenseRuns;

                    card.classList.remove('d-none');

                    if (off && off.valid) {
                        if (type === 'full') {
                            textEl.textContent = 'License aktif (Full / lifetime)';
                        } else if (type === 'date') {
                            var msg = 'License aktif';
                            try {
                                if (off.payload && off.payload.exp) {
                                    var dt = new Date(Number(off.payload.exp));
                                    if (!Number.isNaN(dt.getTime())) {
                                        var dd = String(dt.getDate()).padStart(2,'0');
                                        var mm = String(dt.getMonth()+1).padStart(2,'0');
                                        var yy = dt.getFullYear();
                                        msg += ' - berlaku sampai ' + dd + '-' + mm + '-' + yy;
                                    }
                                }
                            } catch (e2) {}
                            if (rem != null) {
                                msg += ' (sisa ' + rem + ' hari)';
                            }
                            textEl.textContent = msg;
                        } else if (type === 'runs' && runs) {
                            var rRem = (typeof runs.remainingRuns === 'number') ? runs.remainingRuns : null;
                            var rTot = (typeof runs.totalRuns === 'number') ? runs.totalRuns : null;
                            var parts = ['License aktif - berbasis jumlah buka aplikasi'];
                            if (rTot != null && rRem != null) {
                                parts.push('(sisa ' + rRem + ' dari ' + rTot + ' kali)');
                            } else if (rRem != null) {
                                parts.push('(sisa ' + rRem + ' kali)');
                            }
                            textEl.textContent = parts.join(' ');
                        } else {
                            textEl.textContent = 'License aktif';
                        }
                    } else {
                        if (off && off.reason) {
                            textEl.textContent = 'Belum aktif (' + off.reason + ')';
                        } else {
                            textEl.textContent = 'Belum aktif';
                        }
                    }
                } catch (e) {}
            }

            async function submitLicenseAdmin() {
                try {
                    var input = document.getElementById('licenseKeyInputAdmin');
                    var textEl = document.getElementById('licenseStatusAdminText');
                    if (!input || !textEl) return;
                    var key = String(input.value || '').trim();
                    if (!key) {
                        textEl.textContent = 'LICENSE KEY wajib diisi';
                        return;
                    }
                    textEl.textContent = 'Memeriksa LICENSE KEY...';
                    var resp = await fetch('/api/license/offline', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                        body: JSON.stringify({ licenseKey: key })
                    });
                    var data = null;
                    try { data = await resp.json(); } catch (e) {}
                    if (resp.ok && data && data.success) {
                        textEl.textContent = 'License aktif';
                        input.value = '';
                        try { await refreshLicenseAdmin(); } catch (e2) {}
                        // Reload halaman agar badge trial/license dan status lain ikut terupdate
                        setTimeout(function () {
                            try { window.location.reload(); } catch (e3) {}
                        }, 400);
                    } else {
                        var msg = (data && data.message) ? data.message : 'LICENSE KEY tidak valid';
                        textEl.textContent = msg;
                    }
                } catch (e) {}
            }

            function initLicenseAdmin() {
                refreshLicenseAdmin();
                var btn = document.getElementById('licenseSaveBtnAdmin');
                if (btn) {
                    btn.addEventListener('click', function (ev) {
                        ev.preventDefault();
                        submitLicenseAdmin();
                    });
                }
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initLicenseAdmin);
            } else {
                initLicenseAdmin();
            }
        })();
    </script>
  
  <!-- Admin Camera Scanner Modal -->
  <div class="modal fade" id="adminCameraModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header border-0">
          <h5 class="modal-title"><i class="bi bi-camera-video"></i> Scan Kamera</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body pt-0">
          <video id="adminCameraVideo" style="width:100%;max-height:60vh;background:#000" autoplay muted playsinline></video>
          <small class="text-muted">Arahkan barcode/QR ke kamera. Deteksi akan otomatis.</small>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Tutup</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Update Check Modal -->
  <div class="modal fade" id="updateCheckModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="bi bi-cloud-download"></i> Cek Update Aplikasi
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="updateCheckContent">
            <div class="text-center">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Memeriksa update...</span>
              </div>
              <p class="mt-3">Sedang memeriksa update aplikasi...</p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
          <button type="button" class="btn btn-primary d-none" id="downloadUpdateBtn">
            <i class="bi bi-download"></i> Download Update
          </button>
        </div>
      </div>
    </div>
  </div>
    
    <!-- Back to Top Button -->
    <button id="backToTopBtn" class="btn btn-primary back-to-top" title="Back to Top">
        <i class="bi bi-arrow-up"></i>
    </button>
</body>
</html>