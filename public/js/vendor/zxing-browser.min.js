(function(){
  try {
    if ((window.ZXingBrowser && window.ZXingBrowser.BrowserMultiFormatReader) ||
        (window.ZXing && window.ZXing.BrowserMultiFormatReader)) {
      return;
    }
  } catch (e) {}

  var candidates = [
    // Local offline bundle (place @zxing/library UMD here to work fully offline)
    '/js/vendor/zxing-library.min.js',
    // ZXing browser wrapper
    'https://unpkg.com/@zxing/browser@0.1.5/umd/index.min.js',
    'https://cdn.jsdelivr.net/npm/@zxing/browser@0.1.5/umd/index.min.js',
    'https://unpkg.com/@zxing/browser@0.1.4/umd/index.min.js',
    'https://cdn.jsdelivr.net/npm/@zxing/browser@0.1.4/umd/index.min.js',
    // Core ZXing library (also exposes BrowserMultiFormatReader under global ZXing)
    'https://unpkg.com/@zxing/library@0.12.3/umd/index.min.js',
    'https://cdn.jsdelivr.net/npm/@zxing/library@0.12.3/umd/index.min.js'
  ];

  function loadNext(i){
    if (i >= candidates.length) return;
    var url = candidates[i];
    var s = document.createElement('script');
    s.src = url;
    s.async = true;
    s.onload = function(){
      try {
        var ok = (window.ZXingBrowser && window.ZXingBrowser.BrowserMultiFormatReader) ||
                 (window.ZXing && window.ZXing.BrowserMultiFormatReader);
        if (!ok) { loadNext(i+1); }
      } catch (e) { loadNext(i+1); }
    };
    s.onerror = function(){ loadNext(i+1); };
    document.head.appendChild(s);
  }

  loadNext(0);
})();
